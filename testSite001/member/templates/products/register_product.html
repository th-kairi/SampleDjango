{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto p-4">
    <h2 class="text-2xl font-bold mb-4">商品登録</h2>
    <form method="post" enctype="multipart/form-data" id="productForm">
        {% csrf_token %}

        <!-- 商品画像 -->
        <div id="image-upload-section" class="mb-4">
            <label class="block text-lg font-medium mb-2">商品画像:</label>
            <div id="image-preview-container" 
                 class="d-flex gap-3 overflow-auto p-2 border rounded" 
                 style="white-space: nowrap; max-width: 100%; height: 130px;">
                <!-- プラスボタン -->
                <button 
                    type="button" 
                    id="add-image-button" 
                    class="d-flex align-items-center justify-content-center border border-dashed rounded bg-light text-muted"
                    style="width: 100px; height: 100px;">
                    ＋
                </button>
            </div>
            <input type="file" name="images" id="image-input" class="d-none" multiple>
        </div>

        <!-- 商品情報 -->
        <div class="mb-4">
            <label for="name" class="block text-lg font-medium mb-2">タイトル:</label>
            {{ product_form.name }}
        </div>

        <div class="mb-4">
            <label for="price" class="block text-lg font-medium mb-2">金額:</label>
            {{ product_form.price }}
        </div>

        <div class="mb-4">
            <label for="description" class="block text-lg font-medium mb-2">説明:</label>
            {{ product_form.description }}
        </div>

        <!-- ボタン -->
        <div class="d-flex gap-3">
            <button type="submit" class="btn btn-primary">登録する</button>
            <a href="{% url 'member:product_list' %}" class="btn btn-secondary">キャンセル</a>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('image-input');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const addImageButton = document.getElementById('add-image-button');

        // プラスボタンを押すと画像選択をトリガー
        addImageButton.addEventListener('click', () => {
            imageInput.click();
        });

        // 画像選択時の処理
        imageInput.addEventListener('change', () => {
            const files = Array.from(imageInput.files);

            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    // プレビュー画像を作成
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.alt = "選択した画像";
                    img.className = "rounded border shadow-sm";
                    img.style = "width: 100px; height: 100px; object-fit: cover;";

                    // 削除ボタンを作成
                    const removeBtn = document.createElement('button');
                    removeBtn.type = "button";
                    removeBtn.innerHTML = "×";
                    removeBtn.className = "btn btn-danger btn-sm position-absolute";
                    removeBtn.style = "top: 5px; right: 5px;";
                    removeBtn.onclick = () => container.remove();

                    // プレビュー要素を追加
                    const container = document.createElement('div');
                    container.className = "position-relative d-inline-block";
                    container.style = "width: 100px; height: 100px; margin-right: 10px;";
                    container.appendChild(img);
                    container.appendChild(removeBtn);

                    imagePreviewContainer.insertBefore(container, addImageButton);
                };
                reader.readAsDataURL(file);
            });

            imageInput.value = ''; // 再度追加可能にする
        });
    });
</script>
{% endblock %}
