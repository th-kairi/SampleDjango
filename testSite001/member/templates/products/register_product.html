{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto p-4">
    <h2 class="text-2xl font-bold mb-4">商品登録</h2>
    <form method="post" enctype="multipart/form-data" id="productForm">
        {% csrf_token %}
        
        <!-- 商品画像 -->
    <div id="image-upload-section" class="mb-4">
        <label class="block text-lg font-medium mb-2">商品画像:</label>
        <div id="image-preview-container" class="flex gap-4 overflow-x-auto pb-2">
            <!-- プラスボタン -->
            <button 
                type="button" 
                id="add-image-button" 
                class="w-24 h-24 flex items-center justify-center border border-dashed border-gray-300 rounded-lg text-gray-500 text-2xl">
                ＋
            </button>
        </div>
        <input type="file" name="images" id="image-input" class="hidden" multiple>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const imageInput = document.getElementById('image-input');
            const imagePreviewContainer = document.getElementById('image-preview-container');
            const addImageButton = document.getElementById('add-image-button');

            // プラスボタンを押すと画像選択をトリガー
            addImageButton.addEventListener('click', () => {
                imageInput.click();
            });

            // 画像選択時の処理
            imageInput.addEventListener('change', () => {
                const files = Array.from(imageInput.files);

                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // プレビュー画像を作成
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = "選択した画像";
                        img.className = "w-24 h-24 object-cover rounded-lg shadow";

                        // 削除ボタンを作成
                        const removeBtn = document.createElement('button');
                        removeBtn.type = "button";
                        removeBtn.innerHTML = "×";
                        removeBtn.className = "absolute top-0 right-0 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center";
                        removeBtn.onclick = () => container.remove();

                        // プレビュー要素を追加
                        const container = document.createElement('div');
                        container.className = "relative flex-shrink-0";
                        container.appendChild(img);
                        container.appendChild(removeBtn);

                        imagePreviewContainer.insertBefore(container, addImageButton);
                    };
                    reader.readAsDataURL(file);
                });

                imageInput.value = ''; // 再度追加可能にする
            });
        });
    </script>
{% endblock %}
