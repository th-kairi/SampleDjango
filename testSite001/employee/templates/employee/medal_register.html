<!-- medal_register.html -->
{% extends 'base.html' %}

{% block content %}
    <div class="container">
        <h2>勲章登録</h2>

        <!-- 会員検索フォーム -->
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}

            <!-- プラスボタン -->
            <button type="button" class="btn btn-light rounded-circle" id="add-medal-btn" style="width: 40px; height: 40px; background-color: lightgray; margin-right: 10px;">
                <span class="text-dark" style="font-size: 20px;">+</span>
            </button>

            <!-- 送信ボタン -->
            <button type="submit" class="btn btn-primary mt-3">勲章を登録</button>
        </form>

        <!-- ポップアップ (モーダル) -->
        <div class="modal" id="medalModal" tabindex="-1" role="dialog" aria-labelledby="medalModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="medalModalLabel">勲章を選択</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="閉じる">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="medal-list">
                            <!-- Medal モデルの勲章を表示 -->
                            {% for medal in medals %}
                                <div class="medal-item" data-id="{{ medal.id }}">
                                    <img src="{{ medal.image.url }}" alt="{{ medal.title }}" width="50" height="50">
                                    <p>{{ medal.title }}</p>
                                </div>
                            {% empty %}
                                <p>登録された勲章はありません。</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">閉じる</button>
                        <button type="button" class="btn btn-primary" id="add-medal-to-form">選択した勲章を登録</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // プラスボタンをクリックした時の動作
        document.getElementById('add-medal-btn').addEventListener('click', function() {
            // モーダルを表示
            $('#medalModal').modal('show');
        });

        // 勲章の選択と追加
        let selectedMedals = [];  // 選択した勲章を格納する配列

        document.querySelectorAll('.medal-item').forEach(function(item) {
            item.addEventListener('click', function() {
                // 勲章の選択
                const medalId = item.dataset.id;
                if (!selectedMedals.includes(medalId)) {
                    selectedMedals.push(medalId);
                    item.classList.add('selected');
                }
            });
        });

        // 登録ボタンがクリックされたとき
        document.getElementById('add-medal-to-form').addEventListener('click', function() {
            // 勲章選択後、フォームに勲章を追加
            if (selectedMedals.length > 0) {
                const medalsContainer = document.getElementById('medal-list');
                selectedMedals.forEach(function(medalId) {
                    const medalItemHtml = `
                        <div class="medal-item mb-3" style="display: inline-block; margin-right: 15px;">
                            <label>選択する勲章:</label>
                            <div class="form-check">
                                <input type="checkbox" name="medals" value="${medalId}" class="form-check-input">
                                <img src="/static/images/medal_icon.jpg" alt="Medal ${medalId}" width="50" height="50" class="mr-2">
                                勲章${medalId}
                            </div>
                        </div>
                    `;
                    medalsContainer.innerHTML += medalItemHtml;
                });

                // モーダルを閉じる
                $('#medalModal').modal('hide');
            }
        });
    </script>
{% endblock %}
